enum tier {
  free_trial [note: 'Free Trial tier will get their infras data wiped after 30 days']
  bronze
  silver
  gold
  platinum [note: 'Platinum tier will get their own dedicated infra']
}


Table tenants {
  id UUID [pk]
  name varchar(255)
  domain varchar(255)
  tier tier
  infra_id UUID [ref: > tenant_infras.id]

  created_at timestamp
  updated_at timestamp
}

Table users {
  id UUID [pk]

  created_at timestamp
  updated_at timestamp
}

Table users_tenants {
  user_id UUID [ref: > users.id]
  tenant_id UUID [ref: > tenants.id]

  created_at timestamp
  updated_at timestamp

  indexes {
    (user_id, tenant_id) [pk]
  }
}

Table tenant_infras {
  id UUID [pk]
  name varchar(255)
  kafka_brokers "varchar(255)[]"
  schema_registry_url varchar(255)
  kafka_connect_url varchar(255)
  kms_key varchar(255)

  created_at timestamp
  updated_at timestamp
}

Table sources {
  id UUID [pk]
  tenant_id UUID [ref: > tenants.id]
  name varchar(255)
  
  created_by_user_id UUID [ref: > users.id]
  updated_by_user_id UUID [ref: > users.id]
  created_at timestamp
  updated_at timestamp
}

Table source_tags {
  source_id UUID [ref: > sources.id]
  key varchar(255)
  value varchar(255)

  created_by_user_id UUID [ref: > users.id]
  updated_by_user_id UUID [ref: > users.id]
  created_at timestamp
  updated_at timestamp

  indexes {
    (source_id, key) [pk]
  }
}

Table source_app_configs {
  source_id UUID [ref: > sources.id]
  key varchar(255)
  value varchar(255)

  created_by_user_id UUID [ref: > users.id]
  updated_by_user_id UUID [ref: > users.id]
  created_at timestamp
  updated_at timestamp

  indexes {
    (source_id, key) [pk]
  }
}

Table source_app_tables {
  id UUID [pk]
  source_id UUID [ref: > sources.id]
  db_name varchar(255)
  schema_name varchar(255)
  table_name varchar(255)

  created_by_user_id UUID [ref: > users.id]
  updated_by_user_id UUID [ref: > users.id]
  created_at timestamp
  updated_at timestamp

  indexes {
    (source_id, db_name, schema_name, table_name) [unique]
  }
}

Table source_app_columns {
  table_id UUID [ref: > source_app_tables.id]
  column_name varchar(255)
  data_type varchar(255)

  created_by_user_id UUID [ref: > users.id]
  updated_by_user_id UUID [ref: > users.id]
  created_at timestamp
  updated_at timestamp

  indexes {
    (table_id, column_name) [pk]
  }
}

Table source_kc_connectors {
  id UUID [pk]
  source_id UUID [ref: > sources.id]
  name varchar(255) [unique]
  connector_class varchar(255)
  version varchar(255)

  created_by_user_id UUID [ref: > users.id]
  updated_by_user_id UUID [ref: > users.id]
  created_at timestamp
  updated_at timestamp
}

Table source_kc_configs {
  kc_id UUID [ref: > source_kc_connectors.id]
  key varchar(255)
  value text

  created_by_user_id UUID [ref: > users.id]
  updated_by_user_id UUID [ref: > users.id]
  created_at timestamp
  updated_at timestamp

  indexes {
    (kc_id, key) [pk]
  }
}

Table destinations {
  id UUID [pk]
  tenant_id UUID [ref: > tenants.id]
  name varchar(255)

  created_by_user_id UUID [ref: > users.id]
  updated_by_user_id UUID [ref: > users.id]
  created_at timestamp
  updated_at timestamp
}

Table destination_tags {
  destination_id UUID [ref: > destinations.id]
  key varchar(255)
  value varchar(255)

  created_by_user_id UUID [ref: > users.id]
  updated_by_user_id UUID [ref: > users.id]
  created_at timestamp
  updated_at timestamp

  indexes {
    (destination_id, key) [pk]
  }
}

Table destination_app_configs {
  destination_id UUID [ref: > destinations.id]
  key varchar(255)
  value varchar(255)

  created_by_user_id UUID [ref: > users.id]
  updated_by_user_id UUID [ref: > users.id]
  created_at timestamp
  updated_at timestamp

  indexes {
    (destination_id, key) [pk]
  }
}

Table destination_kc_connectors {
  id UUID [pk]
  destination_id UUID [ref: > destinations.id]
  name varchar(255) [not null, unique]
  connector_class varchar(255)
  version varchar(255)

  created_by_user_id UUID [ref: > users.id]
  updated_by_user_id UUID [ref: > users.id]
  created_at timestamp
  updated_at timestamp
}

Table destination_kc_configs {
  kc_id UUID [ref: > destination_kc_connectors.id]
  key varchar(255)
  value text

  created_by_user_id UUID [ref: > users.id]
  updated_by_user_id UUID [ref: > users.id]
  created_at timestamp
  updated_at timestamp

  indexes {
    (kc_id, key) [pk]
  }
}

Table pipelines {
  id UUID [pk]
  tenant_id UUID [ref: > tenants.id]
  source_id UUID [ref: > sources.id]
  destination_id UUID [ref: > destinations.id]
  name varchar(255)
  
  created_by_user_id UUID [ref: > users.id]
  updated_by_user_id UUID [ref: > users.id]
  created_at timestamp
  updated_at timestamp
}

Table pipeline_tags {
  pipeline_id int [ref: > pipelines.id]
  key varchar(255)
  value varchar(255)

  created_by_user_id UUID [ref: > users.id]
  updated_by_user_id UUID [ref: > users.id]
  created_at timestamp
  updated_at timestamp

  indexes {
    (pipeline_id, key) [pk]
  }
}

Table pipeline_app_configs {
  pipeline_id UUID [ref: > pipelines.id]
  key varchar(255)
  value varchar(255)

  created_by_user_id UUID [ref: > users.id]
  updated_by_user_id UUID [ref: > users.id]
  created_at timestamp
  updated_at timestamp

  indexes {
    (pipeline_id, key) [pk]
  }
}

Table pipelines_source_app_tables {
  pipeline_id UUID [ref: > pipelines.id]
  table_id UUID [ref: > source_app_tables.id]

  created_by_user_id UUID [ref: > users.id]
  updated_by_user_id UUID [ref: > users.id]
  created_at timestamp
  updated_at timestamp

  indexes {
    (pipeline_id, table_id) [pk]
  }
}
